<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd">

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>

<rfc category="std" ipr="trust200902" docName="draft-ietf-bfcpbis-rfc4583bis-20" obsoletes="4583">

<?rfc strict="yes"?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="no"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<front>
  <title abbrev="BFCP">Session Description Protocol (SDP) Format for Binary Floor Control Protocol (BFCP) Streams</title>

  
  <author initials="C.H." surname="Holmberg" fullname="Christer Holmberg">
    <organization>Ericsson</organization>
    <address>
       <postal>
         <street>Hirsalantie 11</street>
          <code>02420</code>
          <city>Jorvas</city>
          <country>Finland</country>
       </postal>
       <email>christer.holmberg@ericsson.com</email>
     </address>
  </author>
  
  <author initials="G." surname="Camarillo" fullname="Gonzalo Camarillo">
    <organization>Ericsson</organization>
    <address>
      <postal>
        <street>Hirsalantie 11</street>
        <city>FI-02420 Jorvas</city>
        <country>Finland</country>
      </postal>
      <email>Gonzalo.Camarillo@ericsson.com</email>
    </address>
  </author>

  <author fullname="Tom Kristensen" initials="T." surname="Kristensen">
    <organization>Cisco</organization>
    <address>
      <postal>
        <street>Philip Pedersens vei 1</street>
        <city>NO-1366 Lysaker</city>
        <country>Norway</country>
      </postal>
      <email>tomkrist@cisco.com, tomkri@ifi.uio.no</email>
    </address>
  </author>

  <date year="2018"/>

  <area>Real-time Applications and Infrastructure</area>
  <workgroup>BFCPbis Working Group</workgroup>

  <keyword>floor control</keyword>
  <keyword>BFCP</keyword>
  <keyword>SDP</keyword>

  <abstract>
   <t>This document defines the Session Description Protocol (SDP) offer/answer procedures for negotiating and establishing Binary Floor Control Protocol (BFCP) streams.</t>
    <t>This document obsoletes RFC 4583. Changes from RFC 4583 are summarized in Section 15.</t>
    <!--                                 Ensure correct section #, as xref is not allowed in abstract -->
  </abstract>
</front>

<middle>
  <section title="Introduction">
    <t>As discussed in the BFCP (Binary Floor Control Protocol) specification <xref target="I-D.ietf-bfcpbis-rfc4582bis"/>, a given BFCP client needs a set of data in order to establish a BFCP connection to a floor control server. This data includes the transport address of the server, the conference identifier, and the user identifier.</t>
    <t>One way for clients to obtain this information is to use an SDP offer/answer <xref target="RFC3264"/> exchange. This document specifies how to encode this information in the SDP session descriptions that are part of such an offer/answer exchange.</t>
    <t>User agents typically use the offer/answer model to establish a number of media streams of different types. Following this model, a BFCP connection is described as any other media stream by using an SDP 'm' line, possibly followed by a number of attributes encoded in 'a' lines.</t>
  </section>

  <section title="Terminology" anchor="sec:terminology">
    <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14, <xref target="RFC2119">RFC 2119</xref> and indicate requirement levels for compliant implementations.</t>
  </section>

  <section title="Fields in the 'm' Line" anchor="sec:m-line">
    <t>This section describes how to generate an 'm' line for a BFCP stream.</t>
    <t>According to the SDP specification <xref target="RFC4566"/>, the 'm' line format is the following:</t>
    <t><list style="hanging">
        <t><![CDATA[m=<media> <port> <proto> <fmt> ...]]></t>
    </list></t>
    <t>The media field MUST have a value of "application".</t>
    <t>The port field is set depending on the value of the proto field, as explained below.  A port field value of zero has the standard SDP meaning (i.e., rejection of the media stream) regardless of the proto field.</t>
    <t><list style="hanging">
        <t>When TCP is used as the transport, the port field is set following the rules in <xref target="RFC4145"/>. Depending on the value of the 'setup' attribute (discussed in <xref target="sec:tcp-connection"/>), the port field contains the port to which the remote endpoint will direct BFCP messages, or in the case where the endpoint will initiate the connection towards the remote endpoint, should be set to a value of 9.</t>
        <t>When UDP is used as the transport, the port field contains the port to which the remote endpoint will direct BFCP messages regardless of the value of the 'setup' attribute.</t>
    </list></t>
    <t>This document defines five values for the proto field: TCP/BFCP, TCP/DTLS/BFCP, TCP/TLS/BFCP, UDP/BFCP, and UDP/TLS/BFCP.</t> <!-- Just TCP/BFCP and TCP/TLS/BFCP in rfc4583 -->
    <t>TCP/BFCP is used when BFCP runs directly on top of TCP. TCP/TLS/BFCP is used when BFCP runs on top of TLS, which in turn runs on top of TCP. TCP/DTLS/BFCP is used when running BFCP on top of DTLS <xref target="RFC6347"/>, as described in this specification, which in turn runs on top of TCP using the framing method defined in  <xref target="RFC4571"/> with DTLS packets being sent and received instead of RTP/RTCP packets using the shim defined in RFC4571 such that the length field defined in RFC4571 precedes each DTLS message.</t>
    <t>Similarly, UDP/BFCP is used when BFCP runs directly on top of UDP, and UDP/TLS/BFCP is used when BFCP runs on top of DTLS, which in turn runs on top of UDP.</t>
    <t>The fmt (format) list is not applicable to BFCP. The fmt list of 'm' lines in the case of any proto field value related to BFCP MUST contain a single "*" character. If the the fmt list contains any other value it is ignored.</t>
    <t>The following is an example of an 'm' line for a BFCP connection:</t>
    <figure>
      <artwork>
   m=application 50000 TCP/TLS/BFCP *
      </artwork>
    </figure>
  </section>

  <section title="Floor Control Roles" anchor="sec:server-determination">
    <t>
       When two endpoints establish a BFCP stream, they need to determine which of them acts as floor control client and which acts as floor control server. 
       Typically, a client that establishes a BFCP stream with a conference server will act as floor control client, while the conference server will act as 
       floor control server. However, there are scenarios where both endpoints would be able to act as floor control server. For example, in a two-party session 
       that involves an audio stream and a shared whiteboard, the endpoints need to determine which party will be act as floor control server.
    </t>
    <t>
       Furthermore, there are situations where both endpoints act as both floor control client and floor control server within the same session. 
       For example, in a two-party session that involves an audio stream and a shared whiteboard, one endpoint acts as the floor control server for the 
       audio stream and the other endpoint acts as the floor control server for the shared whiteboard. However, for a given BFCP-controlled media stream one endpoint MUST 
       act as floor control client and one endpoint MUST act as floor control server.
    </t>
 </section>
  <section title="SDP 'floorctrl' Attribute" anchor="sec:floorctrl-attr">
      <t>
         This section defines the SDP 'floorctrl' media-level attribute. The attribute is used to determine the floor control role(s) that the endpoints
         can take for the BFCP-controlled media streams. As described in <xref target="sec:floorctrl-attr"/>, an endpoint can take different roles for different
         media streams, but for a given media stream an endpoint can only take one role.
      </t>
      <t>
        The Augmented BNF syntax <xref target="RFC5234"/> for the attribute is:
      </t> 
      <figure>
        <artwork type='abnf'>
floor-control-attribute  = "a=floorctrl:" role *(SP role)
role                     = "c-only" / "s-only" / "c-s"
        </artwork>
      </figure>
      <t>An endpoint includes the attribute to indicate the role(s) it would be willing to perform for the BFCP-controlled media streams:</t>
      <t><list style="hanging">
          <t hangText="c-only:">The endpoint is willing to act as floor control client.</t>
          <t hangText="s-only:">The endpoint is willing to act as floor control server only.</t>
          <t hangText="c-s:">The endpoint is willing to act as floor control client and floor control server.</t>
      </list></t>
      <t>
        When inserted in an offer, the offerer MAY indicate multiple attribute values. When inserted in an answer, the answerer MUST 
        indicate only one attribute value. The offerer indicates which floor control role(s) that it is willing to take. The answerer 
        indicates the role taken by the answerer. Based on this, the floor control role(s) of the offerer is determined,
        as shown in <xref target="tab-roles"/>.
      </t>
      <texttable title="Roles" anchor="tab-roles">
          <ttcol align="center">Offerer</ttcol>
          <ttcol align="center">Answerer</ttcol>

          <c>c-only</c>
          <c>s-only</c>

          <c>s-only</c>
          <c>c-only</c>

          <c>c-s</c>
          <c>c-s</c>
      </texttable> 
      <t>
        Endpoints compliant with <xref target="RFC4583"/> might not include the 'floorctrl' attribute in offers and answerer. 
        If the 'floorctrl' attribute is not present the offerer will act as floor control client, and the answerer will act as floor control server, for each BFCP-controlled media stream.
      </t>
      <t>
        The SDP Offer/Answer procedures for the 'floorctrl' attribute are defined in <xref target="sec:oa-offer-answer-proc"/>.
      </t>
      <t>The following is an example of a 'floorctrl' attribute in an offer:</t>
      <figure>
        <artwork>
          a=floorctrl:c-only s-only c-s
        </artwork>
      </figure>
  </section>

  <section title="SDP 'confid' and 'userid' Attributes" anchor="sec:confid-userid-attr">
    <t>
      This section defines the SDP 'confid' and the 'userid' media-level attributes. The attributes are used by a floor control server 
      to convey the conference ID value and user ID value to the floor control client, using decimal integer representation.
    </t>  
    <t>
        The Augmented BNF syntax <xref target="RFC5234"/> for the attributes is:
    </t> 
    <figure>
      <artwork type='abnf'>
confid-attribute      = "a=confid:" conference-id
conference-id         = token
userid-attribute      = "a=userid:" user-id
user-id               = token

token-char            = %x21 / %x23-27 / %x2A-2B / %x2D-2E / %x30-39
                        / %x41-5A / %x5E-7E
token                 = 1*(token-char)

   ;token-char and token elements are defined in [RFC4566].
      </artwork>
    </figure>
    <t>
      The SDP Offer/Answer procedures for the 'confid' and 'userid' attributes are defined in <xref target="sec:oa-offer-answer-proc"/>.
    </t>
   </section>

  <section title="SDP 'floorid' Attribute" anchor="sec:floorid-attr">
    <t>
      This section defines the SDP 'floorid' media-level attribute. The attribute conveys a floor identifier, and optionally pointers to one or more
      BFCP-controlled media streams.
    </t>      
    <t>
      The Augmented BNF syntax <xref target="RFC5234"/> for the attribute is:
    </t> 
    <figure>
      <artwork type='abnf'>
floor-id-attribute = "a=floorid:" token SP "mstrm:" token *(SP token)
      </artwork>
    </figure>
    <t>
      The floor identifier value is the integer representation of the Floor ID to be used in BFCP. Each media stream
      pointer value is associated with an SDP 'label' attribute <xref target="RFC4574"/> of a media stream.
    </t>
    <t>
      The SDP Offer/Answer procedures for the 'floorid' attribute are defined in <xref target="sec:oa-offer-answer-proc"/>.
    </t>
    <t><list style="empty">
    <t>
      Note: In <xref target="RFC4583"/> 'm-stream' was erroneously used in <xref target="sec:example"/>. Although the example was non-normative, it is 
      implemented by some vendors and occurs in cases where the endpoint is willing to act as an server. Therefore, it is RECOMMENDED to support parsing and 
      interpreting 'm-stream' the same way as 'mstrm' when receiving.
    </t>
    </list></t>
  </section>

  <section title="SDP 'bfcpver' Attribute" anchor="sec:bfcp-version-attr">
    <t>
      This section defines the SDP 'bfcpver' media-level attribute. The attribute is used to negotiate the BFCP version.
    </t>
    <t>
      The Augmented BNF syntax <xref target="RFC5234"/> for the attributes is:
    </t> 
       
    <figure>
      <artwork type='abnf'>
bfcp-version-attribute = "a=bfcpver:" bfcp-version *(SP bfcp-version)
bfcp-version           = token
      </artwork>
    </figure>
    <t>
      An endpoint uses the 'bfcpver' attribute to convey the version(s) of BFCP supported by the endpoint, using integer values. For a given version, the attribute 
      value representing the version MUST match the "Version" field that would be presented in the BFCP COMMON-HEADER <xref target="I-D.ietf-bfcpbis-rfc4582bis"/>. 
      The BFCP version that will eventually be used will be conveyed with a BFCP-level Hello/HelloAck.
    </t>
    <t>
      Endpoints compliant with <xref target="RFC4583"/> might not always include the 'bfcpver' attribute in offers and answers. 
      If the 'bfcpver' attribute is not present, the default values are inferred from the transport specified in the 'm' line (<xref target="sec:m-line"/>) 
      associated with the stream. In accordance with definition of the Version field in <xref target="I-D.ietf-bfcpbis-rfc4582bis"/>, when used over a reliable 
      transport the default attribute value is "1", and when used over an unreliable transport the default attribute value is "2".
    </t>
    <t>
      The SDP Offer/Answer procedures for the 'bfcpver' attribute are defined in <xref target="sec:oa-offer-answer-proc"/>.
    </t>
    </section>
    <section title="Multiplexing Considerations" anchor="sec:mux-cons">
    <t>
      <xref target="I-D.ietf-mmusic-sdp-bundle-negotiation"/> defines how multiplexing of multiple media streams can be negotiated. This specification does not define
      how BFCP streams can be multiplexed with other media streams. Therefore, a BFCP stream MUST NOT be associated with a BUNDLE group <xref target="I-D.ietf-mmusic-sdp-bundle-negotiation"/>.
      Note that BFCP-controlled media streams might be multiplexed with other media streams.
    </t>
    <t>
      <xref target="I-D.ietf-mmusic-sdp-mux-attributes"/> defines the mux categories for the SDP attributes defined in this specification, excluding the SDP 'bfcpver' attribute. .
      <xref target="tab:mux-tbd"/> defines the mux category for the 'bfcpver' attribute:
    </t>
    <texttable title="Multiplexing Attribute Analysis" anchor="tab:mux-tbd">
      <ttcol>Name</ttcol>
      <ttcol>Notes</ttcol>
      <ttcol>Level</ttcol>
      <ttcol>Mux Category</ttcol>

      <c>bfcpver</c>
      <c>Needs further analysis</c>
      <c>M</c>
      <c>TBD</c>
    </texttable>
  </section>

  <section title="BFCP Connection Management" anchor="sec:bfcp-connection">
    <t>
      BFCP streams can use TCP or UDP as the underlying transport. Endpoints exchanging BFCP messages over UDP send the BFCP messages towards the peer 
      using the connection address and port provided in the SDP 'c' and 'm' lines. TCP connection management is more complicated and is described in 
      the following Section.
    </t>
    <t><list style="empty">
      <t>Note: When using Interactive Connectivity Establishment (ICE) <xref target="I-D.ietf-ice-rfc5245bis"/>, TCP/DTLS/BFCP, and UDP/TLS/BFCP, the straight-forward procedures for connection management as UDP/BFCP described above apply. 
      TCP/TLS/BFCP follows the same procedures as TCP/BFCP and is described below.</t>
    </list></t>
    <section title="TCP Connection Management" anchor="sec:tcp-connection">
      <t>
        The management of the TCP connection used to transport BFCP messages is performed using the SDP 'setup' and 'connection' attributes <xref target="RFC4145"/>.
        The 'setup' attribute indicates which of the endpoints initiates the TCP connection. The 'connection' attribute handles TCP connection re-establishment.
      </t>
      <t>
        The BFCP specification <xref target="I-D.ietf-bfcpbis-rfc4582bis"/> describes a number of situations when the TCP connection between a floor control client 
        and the floor control server needs to be re-established. However, that specification does not describe the re-establishment process because this process 
        depends on how the connection was established in the first place. Endpoints using the offer/answer mechanism follow the following rules.
      </t>
      <t>
        When the existing TCP connection is closed and re-established following the rules in <xref target="I-D.ietf-bfcpbis-rfc4582bis"/>, the floor control client 
        MUST send an offer towards the floor control server in order to re-establish the connection. If a TCP connection cannot deliver a BFCP message and times out, 
        the endpoint that attempted to send the message (i.e., the one that detected the TCP timeout) MUST send an offer in order to re-establish the TCP connection.
      </t>
      <t>
        Endpoints that use the offer/answer mechanism to negotiate TCP connections MUST support the 'setup' and 'connection' attributes.
      </t>
    </section>
  </section>

  <section title="Authentication" anchor="sec:authentication">
    <t>
      When a BFCP stream is negotiated using the SDP offer/answer mechanism, it is assumed that the offerer and the answerer authenticate each other using 
      some mechanism. TLS/DTLS is the preferred mechanism. Other mechanisms are possible, but are outside the scope of this document. Once this mutual 
      authentication takes place, all the offerer and the answerer need to ensure is that the entity they are receiving BFCP messages from is the same as 
      the one that generated the previous offer or answer. 
    </t>  
    <t>
      The initial mutual authentication SHOULD take place at the signaling level. Additionally, signaling can use S/MIME <xref target="RFC5750"/> to provide 
      an integrity-protected channel with optional confidentiality for the offer/answer exchange. BFCP takes advantage of this integrity-protected offer/answer 
      exchange to perform authentication. Within the offer/answer exchange, the offerer and answerer exchange the fingerprints of their self-signed certificates. 
      These self-signed certificates are then used to establish the TLS/DTLS connection that will carry BFCP traffic between the offerer and the answerer.
    </t>
    <t>
      Endpoints follow the rules in <xref target="RFC8122"/> regarding certificate choice and presentation. Endpoints that use the offer/answer model to 
      establish BFCP streams MUST support the 'fingerprint' attribute and MUST include it in their offers and answers.
    </t>
    <t>
       When TLS is used with TCP, once the underlying connection is established, the answerer, which can be the floor control client or the floor control server, 
       acts as the TLS server regardless of its role (passive or active) in the TCP establishment procedure. If the TCP connection is lost, the active endpoint 
       is responsible for re-establishing the TCP connection. Unless a new TLS session is negotiated, subsequent SDP offers and answers will not impact the 
       previously negotiated TLS roles.
    </t>
    <t>
       When DTLS is used with UDP, the requirements specified in Section 5 of <xref target="I-D.ietf-mmusic-dtls-sdp"/> MUST be followed.
    </t>
    <t><list style="empty">
        <t>
          Informational note: How to determine which endpoint initiates the TLS/DTLS association depends on the selected underlying transport. 
          It was decided to keep the original semantics in <xref target="RFC4583"/> for TCP to retain backwards compatibility. When using UDP, 
          the procedure defined in <xref target="I-D.ietf-mmusic-dtls-sdp"/> was selected in order to be compatible with other DTLS based protocol 
          implementations, such as DTLS-SRTP. Furthermore, the procedure defined in <xref target="I-D.ietf-mmusic-dtls-sdp"/> do not overload 
          offer/answer semantics and works for offerless INVITE in scenarios with B2BUAs.
        </t>
    </list></t>
  </section>

  <section title="ICE Considerations" anchor="sec:ice-considerations">
    <t>
      Generic SDP offer/answer procedures for Interactive Connectivity Establishment (ICE) are defined in <xref target="I-D.ietf-mmusic-ice-sip-sdp"/>.
    </t>
    <t>
      When BFCP is used with UDP based ICE candidates <xref target="I-D.ietf-ice-rfc5245bis"/> then the procedures for UDP/TLS/BFCP are used.
    </t>
    <t>
      When BFCP is used with TCP based ICE candidates <xref target="RFC6544"/> then the procedures for TCP/DTLS/BFCP are used.
    </t>    
    <t>
      Based on the procedures defined in <xref target="I-D.ietf-mmusic-dtls-sdp"/>, endpoints treat all ICE candidate pairs associated with a BFCP stream on top of a DTLS association 
      as part of the same DTLS association. Thus, there will only be one BFCP handshake and one DTLS handshake even if there are multiple valid candidate pairs, 
      and if BFCF media is shifted between candidate pairs (including switching between UDP to TCP candidate pairs) prior to nomination. If new candidates are added, 
      they will also be part of the same DTLS association.
    </t>
    <t>
      In order to maximize the likelihood of interoperability between the endpoints, all ICE enabled BFCP-over-DTLS endpoints SHOULD 
      implement support for UDP/TLS/BFCP.
    </t>
    <t>
      When an SDP offer or answer conveys multiple ICE candidates for a BFCP stream, UDP based candidates SHOULD be included and 
      the default candidate SHOULD be chosen from one of those UDP candidates. If UDP transport is used for the default candidate, 
      then the 'm' line proto value MUST be 'UDP/TLS/BFCP'. If TCP transport is used for the default candidate, the 'm' line proto 
      value MUST be 'TCP/DTLS/BFCP'.
     </t>     
    <t><list style="empty">
      <t>Note: Usage of ICE with protocols other than UDP/TLS/BFCP and TCP/DTLS/BFCP is outside of scope for this specification.</t>
    </list></t>
  </section>
  
  <section title="SDP Offer/Answer Procedures" anchor="sec:oa-offer-answer-proc">
    <t>
      This section defines the SDP offer/answer <xref target="RFC3264"/> procedures for negotiating and establishing a BFCP stream. 
      Generic procedures for DTLS are defined in <xref target="I-D.ietf-mmusic-dtls-sdp"/>. Generic procedures for TLS are defined 
      in <xref target="RFC8122"/>.
    </t>
    <t>
      This section only defines the BFCP-specific procedures. Unless explicitly stated otherwise, the procedures apply to an 'm' line describing a BFCP stream. If an offer or answer contains multiple 'm' lines describing 
      BFCP streams, the procedures are applied independently to each stream.
    </t>
    <t>
      If the 'm' line 'proto' value is 'TCP/TLS/BFCP', 'TCP/DTLS/BFCP' or 'UDP/TLS/BFCP', the offerer and answerer follow the generic procedures 
      defined in <xref target="RFC8122"/>.
    </t>
    <t>
      If the 'm' line proto value is 'TCP/BFCP', 'TCP/TLS/BFCP', 'TCP/DTLS/TCP' or 'UDP/TLS/BFCP', the offerer and answerer 
      use the SDP 'setup' attribute according to the procedures in <xref target="RFC4145"/>.
    </t>
    <t>
      If the 'm' line proto value is 'TCP/BFCP', 'TCP/TLS/BFCP' or 'TCP/DTLS/BFCP', the offerer and anwerer use 
      the SDP 'connection' attribute according to the procedures in <xref target="RFC4145"/>.
    </t>
    <t><list style="empty">
      <t>Note: The use of source-specific SDP parameters <xref target="RFC5576"/> is not defined to BFCP streams.</t>
    </list></t>
      
    <section title="Generating the Initial SDP Offer" anchor="oa-gen-initial-offer">
      <t>
        When the offerer creates an initial offer, the offerer MUST associate an SDP 'floorctrl' attribute (<xref target="sec:floorctrl-attr"/>) with the 'm' line.
      </t>
      <t>
        In addition, if the offerer includes an SDP 'floorctrl' attribute with 's-only' or 'c-s' attribute values in the offer, the offerer:
      </t>
      <t><list style="symbols">
          <t>MUST associate an SDP 'confid' attribute (<xref target="sec:confid-userid-attr"/>) with the 'm' line;</t>
          <t>MUST associate an SDP 'userid' attribute (<xref target="sec:confid-userid-attr"/>) with the 'm' line;</t>
          <t>MUST associate an SDP 'floorid' attribute (<xref target="sec:floorid-attr"/>) with the 'm' line;</t>
          <t>MUST associate an SDP 'label' attribute (<xref target="sec:floorid-attr"/>) with the 'm' line of each BFCP-controlled media stream; and</t>
          <t>MUST associate an SDP 'bfcpver' attribute (<xref target="sec:bfcp-version-attr"/>) with the 'm' line.</t>
      </list></t>
      <t><list style="empty">
        <t>
          Note: If the offerer includes an SDP 'floorctrl' attribute with an 'c-s' attribute value in the offer, the attribute values above will only be used if it is determined
          (<xref target="sec:floorctrl-attr"/>) that the offerer will act as floor control server. If it is determined that the offerer will act as both floor
          control server and floor control client, the attribute values will be used for the BFCP-controlled media streams where the offerer acts as floor
          control server.
        </t>
      </list></t>
    </section>

    <section title="Generating the SDP Answer" anchor="oa-gen-answer">
      <t>
        When the answerer receives an offer, which contains an 'm' line describing a BFCP stream, if the answerer accepts the 'm' line it:
      </t>
      <t><list style="symbols">
          <t>MUST insert a corresponding 'm' line in the answer, with an identical 'm' line proto value <xref target="RFC3264"/></t>
          <t>MUST, if the offer contained an SDP 'floorctrl' attribute, associate a 'floorctrl' attribute with the 'm' line;</t>
      </list></t>    
      <t>
        In addition, if the answerer includes an SDP 'floorctrl' attribute with 's-only' or 'c-s' attribute values in the answer, the answerer:
      </t>
      <t><list style="symbols">          
          <t>MUST associate an SDP 'confid' attribute with the 'm' line;</t>
          <t>MUST associate an SDP 'userid' attribute with the 'm' line;</t>
          <t>MUST associate an SDP 'floorid' attribute with the 'm' line;</t>
          <t>MUST associate an SDP 'label' attribute with the 'm' line of each BFCP-controlled media stream; and</t>
          <t>MUST associate a 'bfcpver' attribute with the 'm' line.</t>
      </list></t>
      <t><list style="empty">
        <t>
          Note: If the answerer includes an SDP 'floorctrl' attribute with an 'c-s' attribute value in the answer, the attribute values will be used for 
          the BFCP-controlled media streams where the answerer acts as floor control server.
        </t>
        <t>
          Note: An offerer compliant with <xref target="RFC4583"/> might not include 'floorctrl' and 'bfcpver' attributes in offers, in which cases
          the default values apply.
        </t>
      </list></t>
      <t>
        Once the answerer has sent the answer, the answerer:
      </t>
      <t><list style="symbols">
          <t>MUST, if the answerer is the 'active' endpoint, and if a TCP connection associated with the 'm' line is to be established (or re-established), 
             initiate the establishing of the TCP connection; and</t>
          <t>MUST, if the answerer is the 'active' endpoint, and if an TLS/DTLS connection associated with the 'm' line is to be established (or re-established), 
             initiate the establishing of the TLS/DTLS connection (by sending a ClientHello message).</t>
      </list></t>
      <t>
        If the answerer does not accept the 'm' line in the offer, it MUST assign a zero port value to the corresponding 'm' line in the answer. 
        In addition, the answerer MUST NOT establish a TCP connection or a TLS/DTLS connection associated with the 'm' line.
      </t>
    </section>

    <section title="Offerer Processing of the SDP Answer" anchor="oa-offerer-processing-answer">
      <t>
        When the offerer receives an answer, which contains an 'm' line with a non-zero port value, describing a BFCP stream, the offerer:
      </t>
      <t><list style="symbols">
          <t>MUST, if the offer is the 'active' endpoint, and if a TCP connection associated with the 'm' line is to be established (or re-established), 
             initiate the establishing of the TCP connection; and</t>
          <t>MUST, if the offerer is the 'active' endpoint, and if an TLS/DTLS connection associated with the 'm' line is to be established (or re-established), 
             initiate the establishing of the TLS/DTLS connection (by sending a ClientHello message).</t>
      </list></t>
      <t><list style="empty">
        <t>Note: An answerer compliant with <xref target="RFC4583"/> might not include 'floorctrl' and 'bfcpver' attributes in answers, in which cases
        the default values apply.</t>
      </list></t>
      <t>
        If the 'm' line in the answer contains a zero port value, or if the offerer for some other reason does not accept the answer, the offerer MUST NOT establish a 
        TCP connection or a TLS/DTLS connection associated with the 'm' line.
      </t>
    </section>

    <section title="Modifying the Session" anchor="oa-mod-session">
      <t>
        When an offerer sends an updated offer, in order to modify a previously established BFCP stream, it follows the procedures 
        in <xref target="oa-gen-initial-offer"/>, with the following exceptions:
      </t>
      <t><list style="symbols">
          <t>If the BFCP stream is carried on top of TCP, and if the offerer does not want to re-establish an existing TCP connection, the offerer MUST associate 
             an SDP connection attribute with an 'existing' value, with the 'm' line; and</t>
          <t>If the offerer wants to disable a previously established BFCP stream, it MUST assign a zero port value to the 'm' line associated with the 
             BFCP connection, following the procedures in <xref target="RFC3264"/>.</t>
      </list></t>
    </section>

  </section>
 
 <section title="Examples" anchor="sec:example">
    <t>For the purpose of brevity, the main portion of the session description is omitted in the examples, which only show 'm' lines and their attributes.</t>
    <t>The following is an example of an offer sent by a conference server to a client.</t>
    <figure>
      <artwork>
m=application 50000 TCP/TLS/BFCP *
a=setup:actpass
a=connection:new
a=fingerprint:sha-256 \
     19:E2:1C:3B:4B:9F:81:E6:B8:5C:F4:A5:A8:D8:73:04: \
     BB:05:2F:70:9F:04:A9:0E:05:E9:26:33:E8:70:88:A2
a=floorctrl:c-only s-only
a=confid:4321
a=userid:1234
a=floorid:1 mstrm:10
a=floorid:2 mstrm:11
a=bfcpver:1
m=audio 50002 RTP/AVP 0
a=label:10
m=video 50004 RTP/AVP 31
a=label:11
      </artwork>
    </figure>
    <t>Note that due to RFC formatting conventions, this document splits SDP across lines whose content would exceed 72 characters. A backslash character marks where this line folding has taken place. This backslash and its trailing CRLF and whitespace would not appear in actual SDP content.</t>
    <t>The following is the answer returned by the client.</t>
    <figure>
      <artwork>
m=application 9 TCP/TLS/BFCP *
a=setup:active
a=connection:new
a=fingerprint:sha-256 \
     6B:8B:F0:65:5F:78:E2:51:3B:AC:6F:F3:3F:46:1B:35: \
     DC:B8:5F:64:1A:24:C2:43:F0:A1:58:D0:A1:2C:19:08
a=floorctrl:c-only
a=bfcpver:1
m=audio 55000 RTP/AVP 0
m=video 55002 RTP/AVP 31
      </artwork>
    </figure>

<t>A similar example using unreliable transport and DTLS is shown below, where the offer is sent from a client.</t>
    <figure>
      <artwork>
m=application 50000 UDP/TLS/BFCP *
a=setup:actpass
a=dtls-id:abc3dl
a=fingerprint:sha-256 \
     19:E2:1C:3B:4B:9F:81:E6:B8:5C:F4:A5:A8:D8:73:04: \
     BB:05:2F:70:9F:04:A9:0E:05:E9:26:33:E8:70:88:A2
a=floorctrl:c-only s-only
a=confid:4321
a=userid:1234
a=floorid:1 mstrm:10
a=floorid:2 mstrm:11
a=bfcpver:2
m=audio 50002 RTP/AVP 0
a=label:10
m=video 50004 RTP/AVP 31
a=label:11
      </artwork>
    </figure>
    <t>The following is the answer returned by the server.</t>
    <figure>
      <artwork>
m=application 55000 UDP/TLS/BFCP *
a=setup:active
a=dtls-id:abc3dl
a=fingerprint:sha-256 \
     6B:8B:F0:65:5F:78:E2:51:3B:AC:6F:F3:3F:46:1B:35: \
     DC:B8:5F:64:1A:24:C2:43:F0:A1:58:D0:A1:2C:19:08
a=floorctrl:s-only
a=confid:4321
a=userid:1234
a=floorid:1 mstrm:10
a=floorid:2 mstrm:11
a=bfcpver:2
m=audio 55002 RTP/AVP 0
m=video 55004 RTP/AVP 31
      </artwork>
    </figure>
  </section>

  <section title="Security Considerations" anchor="sec:security">
    <t>The BFCP <xref target="I-D.ietf-bfcpbis-rfc4582bis"/>, SDP <xref target="RFC4566"/>, and offer/answer <xref target="RFC3264"/> specifications discuss security issues related to BFCP, SDP, and offer/answer, respectively. In addition, <xref target="RFC4145"/> and <xref target="RFC8122"/> discuss security issues related to the establishment of TCP and TLS connections using an offer/answer model. 
      Furthermore, when using DTLS over UDP, considerations for its use with RTP and RTCP are presented in <xref target="I-D.ietf-mmusic-dtls-sdp"/>.  The requirements for the offer/answer exchange, as listed in Section 5 of <xref target="I-D.ietf-mmusic-dtls-sdp"/>, MUST be followed.</t>
    <t>An initial integrity-protected channel is REQUIRED for BFCP to exchange self-signed certificates between a client and the floor control server. For session descriptions carried in SIP <xref target="RFC3261"/>, S/MIME <xref target="RFC5750"/> is the natural choice to provide such a channel.</t>
  </section>

  <section title="IANA Considerations" anchor="sec:iana">
    <t><list style="empty">
      <t>[Editorial note: The changes in <xref target="sec:proto-reg"/> instruct the IANA to register the three new values TCP/DTLS/BFCP, UDP/BFCP and UDP/TLS/BFCP for the SDP 'proto' field. The new section <xref target="sec:bfcpver-reg"/> registers a new SDP "bfcpver" attribute. The rest is unchanged from <xref target="RFC4582"/>.]</t>
    </list></t>

    <section title="Registration of SDP 'proto' Values" anchor="sec:proto-reg">
      <t>The IANA has registered the following values for the SDP 'proto' field under the Session Description Protocol (SDP) Parameters registry:</t>

      <texttable title="Values for the SDP 'proto' field" anchor="tab:proto-iana">
        <ttcol>Value</ttcol>
        <ttcol align="center">Reference</ttcol>

        <c>TCP/BFCP</c>
        <c>[RFC XXXX]</c>

        <c>TCP/DTLS/BFCP</c>
        <c>[RFC XXXX]</c>

        <c>TCP/TLS/BFCP</c>
        <c>[RFC XXXX]</c>

        <c>UDP/BFCP</c>
        <c>[RFC XXXX]</c>

        <c>UDP/TLS/BFCP</c>
        <c>[RFC XXXX]</c>
      </texttable>
    </section>

    <section title="Registration of the SDP 'floorctrl' Attribute">
      <t>The IANA has registered the following SDP att-field under the Session Description Protocol (SDP) Parameters registry:</t>
      <t><list style="hanging">
          <t hangText="Contact name:             ">iesg@ietf.org</t>
          <t hangText="Attribute name:           ">floorctrl</t>
          <t hangText="Long-form attribute name: ">Floor Control</t>
          <t hangText="Type of attribute:        ">Media level</t>
          <t hangText="Subject to charset:       ">No</t>
          <t hangText="Purpose of attribute:     ">The 'floorctrl' attribute is used to perform floor control server determination.</t>
          <t hangText="Allowed attribute values: "> 1*("c-only" / "s-only" / "c-s")</t>
      </list></t>
    </section>

    <section title="Registration of the SDP 'confid' Attribute">
      <t>The IANA has registered the following SDP att-field under the Session Description Protocol (SDP) Parameters registry:</t>
      <t><list style="hanging">
          <t hangText="Contact name:             ">iesg@ietf.org</t>
          <t hangText="Attribute name:           ">confid</t>
          <t hangText="Long-form attribute name: ">Conference Identifier</t>
          <t hangText="Type of attribute:        ">Media level</t>
          <t hangText="Subject to charset:       ">No</t>
          <t hangText="Purpose of attribute:     ">The 'confid' attribute carries the integer representation of a Conference ID.</t>
          <t hangText="Allowed attribute values: ">A token</t>
      </list></t>
    </section>

    <section title="Registration of the SDP 'userid' Attribute">
      <t>The IANA has registered the following SDP att-field under the Session Description Protocol (SDP) Parameters registry:</t>
      <t><list style="hanging">
          <t hangText="Contact name:             ">iesg@ietf.org</t>
          <t hangText="Attribute name:           ">userid</t>
          <t hangText="Long-form attribute name: ">User Identifier</t>
          <t hangText="Type of attribute:        ">Media level</t>
          <t hangText="Subject to charset:       ">No</t>
          <t hangText="Purpose of attribute:     ">The 'userid' attribute carries the integer representation of a User ID.</t>
          <t hangText="Allowed attribute values: ">A token</t>
      </list></t>
    </section>

    <section title="Registration of the SDP 'floorid' Attribute">
      <t>The IANA has registered the following SDP att-field under the Session Description Protocol (SDP) Parameters registry:</t>
      <t><list style="hanging">
          <t hangText="Contact name:             ">iesg@ietf.org</t>
          <t hangText="Attribute name:           ">floorid</t>
          <t hangText="Long-form attribute name: ">Floor Identifier</t>
          <t hangText="Type of attribute:        ">Media level</t>
          <t hangText="Subject to charset:       ">No</t>
          <t hangText="Purpose of attribute:     ">The 'floorid' attribute associates a floor with one or more media streams.</t>
          <t hangText="Allowed attribute values: ">Tokens</t>
      </list></t>
    </section>
 
    <section title="Registration of the SDP 'bfcpver' Attribute" anchor="sec:bfcpver-reg">
      <t>The IANA has registered the following SDP att-field under the Session Description Protocol (SDP) Parameters registry:</t>
      <t><list style="hanging">
          <t hangText="Contact name:             ">iesg@ietf.org</t>
          <t hangText="Attribute name:           ">bfcpver</t>
          <t hangText="Long-form attribute name: ">BFCP Version</t>
          <t hangText="Type of attribute:        ">Media level</t>
          <t hangText="Subject to charset:       ">No</t>
          <t hangText="Purpose of attribute:     ">The 'bfcpver' attribute lists supported BFCP versions.</t>
          <t hangText="Allowed attribute values: ">Tokens</t>
      </list></t>
    </section>
  </section>

  <section title="Changes from RFC 4583" anchor="sec:changes">
    <t>Following is the list of technical changes and other fixes from <xref target="RFC4583"/>.</t>
    <t>Main purpose of this work was to add signaling support necessary to support BFCP over unreliable transport, as described in <xref target="I-D.ietf-bfcpbis-rfc4582bis"/>, resulting in the following changes:</t>
    <t><list style="numbers">
        <t>Fields in the 'm' line (<xref target="sec:m-line"/>):<vspace/>
          The section is re-written to remove reference to the exclusivity of TCP as a transport for BFCP streams. The proto field values TCP/DTLS/BFCP, UDP/BFCP and UDP/TLS/BFCP added.</t>
        <t>Authentication (<xref target="sec:authentication"/>):<vspace/>
          In last paragraph, made clear that a TCP connection was described.</t>
        <t>Security Considerations (<xref target="sec:security"/>):<vspace/>
          For the DTLS over UDP case, mention existing considerations and requirements for the offer/answer exchange in <xref target="I-D.ietf-mmusic-dtls-sdp"/>.</t>
        <t>Registration of SDP 'proto' Values (<xref target="sec:proto-reg"/>):<vspace/>
          Register the three new values TCP/DTLS/BFCP, UDP/BFCP and UDP/TLS/BFCP in the SDP parameters registry.</t>
        <t>BFCP Version Negotiation (<xref target="sec:bfcp-version-attr"/>):<vspace/>
          A new 'bfcpver' SDP media-level attribute is added in order to signal supported version number.</t>
    </list></t>
    <t>Clarification and bug fixes:</t>
    <t><list style="numbers">
        <t>Errata ID: 712 (<xref target="sec:server-determination"/> and <xref target="sec:oa-offer-answer-proc"/>):<vspace/>
          Language clarification. Don't use terms like an SDP attribute is "used in an 'm' line", instead make clear that the attribute is a media-level attribute.</t>
        <t>Fix typo in example (<xref target="sec:example"/>):<vspace/>
          Do not use 'm-stream' in the SDP example, use the correct 'mstrm' as specified in <xref target="sec:example"/>. Recommend interpreting 'm-stream' if it is received, since it is present in some implementations.</t>
        <t>Assorted clarifications (Across the document):<vspace/>
          Language clarifications as a result of reviews. Also, the normative language where tightened where appropriate, i.e. changed from SHOULD strength to MUST in a number of places.</t>
    </list></t>
  </section>

  <section title="Acknowledgements" anchor="sec:acks">
    <t>Joerg Ott, Keith Drage, Alan Johnston, Eric Rescorla, Roni Even, and Oscar Novo provided useful ideas for the original <xref target="RFC4583"/>. The authors also acknowledge contributions to the revision of BFCP for use over an unreliable transport from Geir Arne Sandbakken, Charles Eckel, Alan Ford, Eoin McLeod and Mark Thompson. Useful and important final reviews were done by Ali C. Begen, Mary Barnes and Charles Eckel. In the final stages, Roman Shpount made a considerable effort in adding proper ICE support and considerations.</t>
  </section>
</middle>

<back>
  <references title="Normative References">
    <?rfc include="reference.RFC.2119" ?>
    <?rfc include="reference.RFC.5234" ?>
    <?rfc include="reference.RFC.3261" ?>
    <?rfc include="reference.RFC.3264" ?>
    <?rfc include="reference.RFC.5750" ?>
    <?rfc include="reference.RFC.4145" ?>
    <?rfc include="reference.I-D.draft-ietf-bfcpbis-rfc4582bis-16" ?>    <!-- TBD increase version! -->
    <?rfc include="reference.RFC.4574" ?>
    <?rfc include="reference.RFC.8122" ?>
    <?rfc include="reference.RFC.4566" ?>
    <?rfc include="reference.RFC.6347" ?>
    <?rfc include="reference.RFC.4571" ?>
    <?rfc include="reference.RFC.6544" ?>
    <?rfc include="reference.I-D.draft-ietf-mmusic-dtls-sdp-32" ?>
    <?rfc include="reference.RFC.4582" ?>
    <?rfc include="reference.RFC.4583" ?>
    <?rfc include="reference.I-D.draft-ietf-ice-rfc5245bis-20"?>
    <?rfc include="reference.I-D.draft-ietf-mmusic-ice-sip-sdp-16"?>
  </references>
  <references title="Informational References">
    <?rfc include="reference.RFC.5576" ?>
    <?rfc include="reference.I-D.draft-ietf-mmusic-sdp-bundle-negotiation-49" ?>
    <?rfc include="reference.I-D.draft-ietf-mmusic-sdp-mux-attributes-17" ?>
  </references>
</back>
</rfc>
